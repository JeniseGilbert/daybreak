<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout - Day Break</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding-bottom: 60px;
      background: #f9f9f9;
    }

    header {
      background: #ffa726;
      padding: 12px;
      text-align: center;
    }

    header img {
      height: 90px;
    }

    .container {
      padding: 16px;
    }

    .cart-summary, .form-section {
      background: #fff;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 16px;
    }

    .input-field {
      width: 96%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    .submit-btn {
      background: #ffa726;
      color: white;
      border: none;
      padding: 14px;
      font-weight: bold;
      width: 100%;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
    }

    .green-btn, .purple-btn {
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      width: 96%;
      margin: 10px 0;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      display: inline-block;
    }

    .green-btn { background-color: #00D632; color: black; }
    .purple-btn { background-color: #6534D1; color: white; }

    #startupModal,
    #txnHelpModal,
    #loaderOverlay,
    #successMessage {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 24px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }

    #startupModal { background: rgba(0,0,0,0.7); display: flex; }
    #txnHelpModal { background: rgba(0,0,0,0.7); }
    #loaderOverlay {
      background: rgba(0,0,0,0.7);
      color: white;
      flex-direction: column;
    }
    .spinner {
      border: 6px solid #f3f3f3;
      border-top: 6px solid #ffa726;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #successMessage {
      background: #f9f9f9;
      display: none;
      flex-direction: column;
    }

    #successMessage .box {
      background: white;
      padding: 30px;
      border-radius: 12px;
      max-width: 90%;
      width: 400px;
      text-align: center;
    }

    footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #ddd;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      font-size: 0.9em;
    }

    footer a {
      flex: 1;
      text-decoration: none;
      color: #444;
      text-align: center;
    }

    footer img {
      width: 28px;
      height: 28px;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>

<header>
  <img src="https://imgur.com/YPspZxy.png" alt="Day Break Logo" />
</header>

<!-- üö® Startup Warning Modal -->
<div id="startupModal">
  <div class="modal-content">
    <h2>Before You Continue</h2>
    <p>After you send your payment via Cash App or Zelle, <strong>you must return to this page </strong> and complete the form below.<br><br>
    <span style="color:red; font-weight:bold;">Your order will not go through</span> without submitting this form.</p>
    <button onclick="document.getElementById('startupModal').style.display='none'" class="submit-btn">Got it</button>
  </div>
</div>




<!-- üßæ Cart Summary -->
<div class="container">
  <div class="cart-summary" id="orderSummary"></div>

  <!-- üë§ Pickup Info -->
  <div class="form-section">
    <h3>Pickup Info</h3>
    <input class="input-field" type="text" id="firstName" placeholder="First Name" required>
    <input class="input-field" type="text" id="lastName" placeholder="Last Name" required>
  </div>

  <!-- üí≥ Payment Info -->
  <div class="form-section">
    <h3>Payment Info</h3>
    <a class="green-btn" href="https://cash.app/$TriniJen14" target="_blank">Pay via Cash App</a>
    <a class="purple-btn" href="#" onclick="alert('Send Zelle payment to 281-730-4040'); return false;">Pay via Zelle</a>

    <label for="paymentMethod">Payment Method:</label>
    <select id="paymentMethod" class="input-field" required onchange="toggleDetails(this.value)">
      <option value="" disabled selected>Select Payment Method</option>
      <option value="cashapp">Cash App</option>
      <option value="zelle">Zelle</option>
    </select>

    <div id="confirm-details" style="display:none;">
      <form id="payment-form">
        <div id="cashappField" style="display:none;">
          <input class="input-field" type="text" id="cashappTag" placeholder="Cash App Tag" required>
        </div>
        <div id="zelleField" style="display:none;">
          <input class="input-field" type="text" id="zelleName" placeholder="Zelle Name or Email" required>
        </div>

        <input class="input-field" type="tel" id="phone" placeholder="Phone Number" required>

        <label for="transactionId">
          Transaction Number
          <a href="#" onclick="document.getElementById('txnHelpModal').style.display='flex'" style="color:#007bff;">Where do I find this?</a>
        </label>
        <input class="input-field" type="text" id="transactionId" placeholder="Transaction Number" required>

        <label>Upload Payment Screenshot:</label>
        <input class="input-field" type="file" id="screenshot" accept="image/*" required>

        <button class="submit-btn" type="submit">Submit Order</button>
      </form>
    </div>
  </div>
</div>

<!-- üîç Transaction Help Modal -->
<div id="txnHelpModal">
  <div class="modal-content">
    <h3>Finding Your Transaction Number</h3>
    <ul style="text-align:left; font-size:0.9em;">
      <li><strong>Cash App:</strong>
        <ol>
          <li>Open Cash App</li>
          <li>Tap Activity tab</li>
          <li>Select your payment</li>
          <li>Scroll to Transaction Number</li>
        </ol>
      </li>
      <li><strong>Zelle:</strong>
        <ol>
          <li>Open your banking app</li>
          <li>Tap on your payment</li>
          <li>Find confirmation or reference number</li>
        </ol>
      </li>
    </ul>
    <button class="green-btn" onclick="document.getElementById('txnHelpModal').style.display='none'">Close</button>
  </div>
</div>

<!-- ‚è≥ Loader Overlay -->
<div id="loaderOverlay">
  <div class="spinner"></div>
  <p>Submitting your order...</p>
</div>

<!-- ‚úÖ Success Confirmation -->
<div id="successMessage">
  <div class="box">
    <h2 style="color:#00C853;">Order Submitted!</h2>
    <p>Your confirmation number is:</p>
    <strong id="confirmCode" style="font-size: 1.4em; color:#ffa726;"></strong><br><br>
    <button onclick="copyConfirmCode()" class="green-btn">Copy Confirmation Number</button><br><br>
    <a href="index.html" class="green-btn">‚Üê Back to Home</a>
  </div>
</div>

<!-- üîª Footer -->
<footer>
  <a href="menu.html"><img src="https://img.icons8.com/?size=100&id=G736SmolvT3J&format=png&color=000000" alt="Menu"><br>Menu</a>
  <a href="cart.html"><img src="https://img.icons8.com/?size=100&id=ii6Lr4KivOiE&format=png&color=000000" alt="Cart"><br>Cart</a>
  <a href="orders.html"><img src="https://img.icons8.com/?size=100&id=MU6RngCQ3iWG&format=png&color=000000" alt="Orders"><br>Orders</a>
</footer>

<script>
const cart = JSON.parse(localStorage.getItem("daybreakCart") || "[]");
let subtotal = 0;

function renderCartSummary() {
  const container = document.getElementById("orderSummary");
  container.innerHTML = '<h3>Your Order</h3>';
  cart.forEach(item => {
    const itemTotal = (item.price * item.qty).toFixed(2);
    subtotal += item.price * item.qty;
    container.innerHTML += `<p>${item.name} (x${item.qty}) - $${itemTotal}</p>`;
  });
  const tax = +(subtotal * 0.0825).toFixed(2);
  const total = +(subtotal + tax).toFixed(2);
  container.innerHTML += `<p><strong>Subtotal:</strong> $${subtotal.toFixed(2)}</p>`;
  container.innerHTML += `<p><strong>Tax:</strong> $${tax.toFixed(2)}</p>`;
  container.innerHTML += `<p><strong>Total:</strong> $${total.toFixed(2)}</p>`;
}

 function toggleDetails(method) {
  document.getElementById("confirm-details").style.display = "block";

  const cashappField = document.getElementById("cashappField");
  const zelleField = document.getElementById("zelleField");
  const cashappInput = document.getElementById("cashappTag");
  const zelleInput = document.getElementById("zelleName");

  if (method === "cashapp") {
    cashappField.style.display = "block";
    zelleField.style.display = "none";
    cashappInput.required = true;
    zelleInput.required = false;
  } else if (method === "zelle") {
    zelleField.style.display = "block";
    cashappField.style.display = "none";
    zelleInput.required = true;
    cashappInput.required = false;
  }
}


function copyConfirmCode() {
  const code = document.getElementById("confirmCode").textContent;
  navigator.clipboard.writeText(code).then(() => alert("Copied!"));
}

document.getElementById("payment-form").addEventListener("submit", async function(e) {
  e.preventDefault();
  document.getElementById("loaderOverlay").style.display = "flex";

  if (cart.length === 0) {
    alert("Your cart is empty. Please add items before submitting.");
    document.getElementById("loaderOverlay").style.display = "none";
    return;
  }

  const confirmation = "DB-" + Math.floor(100000 + Math.random() * 900000);
  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const method = document.getElementById("paymentMethod").value;
  const pickupName = `${firstName} ${lastName}`;
  const paymentName = method === "cashapp"
    ? document.getElementById("cashappTag").value.trim()
    : document.getElementById("zelleName").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const transactionId = document.getElementById("transactionId").value.trim();
  const file = document.getElementById("screenshot").files[0];

  const imgData = new FormData();
  imgData.append("image", file);

  let imageUrl = "";
  try {
    const res = await fetch("https://api.imgur.com/3/image", {
      method: "POST",
      headers: { Authorization: "Client-ID 68f6c28e9fabb52" },
      body: imgData
    });
    const result = await res.json();
    imageUrl = result.success ? result.data.link : "";
  } catch {}

  const formData = new FormData();
  formData.append("pickupName", pickupName);
  formData.append("paymentName", paymentName);
  formData.append("phone", phone);
  formData.append("paymentMethod", method);
  formData.append("transactionId", transactionId);
  formData.append("confirmationNumber", confirmation);
  formData.append("imageUrl", imageUrl);
  formData.append("cart", JSON.stringify(cart));

  await fetch("https://script.google.com/macros/s/AKfycbyJPvqQmWSnSmBi1vj3d-i57ZrcutqqBYaWMBlz7ybrtWG068vmiY7ssUFEtDzuaM8FaA/exec", {
    method: "POST",
    body: formData
  });

  localStorage.removeItem("daybreakCart");
  document.getElementById("loaderOverlay").style.display = "none";
  document.getElementById("confirmCode").textContent = confirmation;
  document.getElementById("successMessage").style.display = "flex";
});

window.onload = () => {
  renderCartSummary();
  document.getElementById("startupModal").style.display = "flex";
};
</script>

</body>
</html>
